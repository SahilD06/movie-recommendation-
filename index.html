<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Review Website</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
      html, body {
    overflow-x: hidden;
  }
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    ::-webkit-scrollbar-thumb {
      background: #ef4444;
      border-radius: 4px;
    }
    /* Star rating */
    .star {
      cursor: pointer;
      transition: color 0.2s;
    }
    .star:hover,
    .star.active {
      color: #fbbf24;
    }
  </style>
</head>
<body class="bg-black text-white">
  <!-- Navigation -->
  <nav class="bg-black border-b border-gray-800 sticky top-0 z-50">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-red-500">üé¨ MovieReviews</h1>
      <div class="flex gap-4">
        <button onclick="showSection('home')" class="nav-btn px-4 py-2 rounded hover:bg-gray-800 transition">Home</button>
        <button onclick="showSection('search')" class="nav-btn px-4 py-2 rounded hover:bg-gray-800 transition">Search</button>
        <button onclick="showSection('my-reviews')" class="nav-btn px-4 py-2 rounded hover:bg-gray-800 transition">My Reviews</button>
      </div>
    </div>
  </nav>

  <!-- Home Section -->
<section id="home" class="section active container mx-auto px-4 py-8">
  <h2 class="text-3xl font-bold mb-6">Trending Movies</h2>

  <!-- Trending Movies Grid -->
  <div id="trending-movies" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
    <!-- Movies will be loaded here -->
  </div>

  <!-- Pagination Controls -->
  <div class="flex justify-center gap-4 mt-6">
    <button id="prev-page" onclick="changePage(-1)" class="px-4 py-2 bg-gray-800 rounded hover:bg-gray-700">Previous</button>
    <span id="current-page" class="px-4 py-2 text-gray-300"></span>
    <button id="next-page" onclick="changePage(1)" class="px-4 py-2 bg-gray-800 rounded hover:bg-gray-700">Next</button>
  </div>
</section>


  <!-- Search Section -->
  <section id="search" class="section hidden container mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold mb-6">Search Movies</h2>
    <div class="mb-6">
      <input 
        type="text" 
        id="search-input" 
        placeholder="Search for movies..." 
        class="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500"
        onkeyup="handleSearch(event)"
      />
    </div>
    <div id="search-results" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
      <!-- Search results will appear here -->
    </div>
  </section>

  <!-- My Reviews Section -->
  <section id="my-reviews" class="section hidden container mx-auto px-4 py-8">
    <h2 class="text-3xl font-bold mb-6">My Reviews</h2>
    <div id="reviews-list" class="space-y-4">
      <!-- Reviews will be loaded here -->
    </div>
  </section>

  <!-- Movie Details Modal -->
  <div id="movie-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4" onclick="closeModal(event)">
    <div class="bg-gray-900 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
      <div id="modal-content">
        <!-- Movie details will be loaded here -->
      </div>
    </div>
  </div>

  <script>
    // Configuration - Replace with your TMDB API key
    const API_KEY = 'e001b089f5aca35cb6f6ef94e603fd61'; // Get free key at https://www.themoviedb.org/settings/api
    const BASE_URL = 'https://api.themoviedb.org/3';
    const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';

    // Local storage for reviews (since we don't have a backend)
    let reviews = JSON.parse(localStorage.getItem('movieReviews') || '[]');

    // Section navigation
    function showSection(sectionName) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.add('hidden');
        section.classList.remove('active');
      });
      document.getElementById(sectionName).classList.remove('hidden');
      document.getElementById(sectionName).classList.add('active');

      if (sectionName === 'my-reviews') {
        displayMyReviews();
      }
    }

// Pagination variables
let currentPage = 1;
let totalPages = 1;

// Fetch trending movies with page number
async function fetchTrendingMovies(page = 1) {
  try {
    const response = await fetch(`${BASE_URL}/trending/movie/week?api_key=${API_KEY}&page=${page}`);
    const data = await response.json();

    displayMovies(data.results, 'trending-movies');

    currentPage = data.page;
    totalPages = data.total_pages;

    const pageSpan = document.getElementById('current-page');
    if (pageSpan) {
      pageSpan.textContent = `Page ${currentPage} of ${totalPages}`;
    }

    // Disable buttons on first/last page
    document.getElementById('prev-page').disabled = currentPage === 1;
    document.getElementById('next-page').disabled = currentPage === totalPages;

  } catch (error) {
    console.error('Error fetching trending movies:', error);
    document.getElementById('trending-movies').innerHTML =
      '<p class="text-red-500 col-span-full text-center">Failed to load movies. Please check your API key.</p>';
  }
}

// Change page
function changePage(delta) {
  const newPage = currentPage + delta;
  if (newPage >= 1 && newPage <= totalPages) {
    fetchTrendingMovies(newPage);
    window.scrollTo({ top: 0, behavior: 'smooth' }); // scroll to top
  }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', () => {
  fetchTrendingMovies();
});



    // Search movies
    let searchTimeout;
    function handleSearch(event) {
      clearTimeout(searchTimeout);
      const query = event.target.value.trim();
      
      if (query.length < 2) {
        document.getElementById('search-results').innerHTML = '';
        return;
      }

      searchTimeout = setTimeout(() => searchMovies(query), 500);
    }

    async function searchMovies(query) {
      try {
        const response = await fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(query)}`);
        const data = await response.json();
        displayMovies(data.results, 'search-results');
      } catch (error) {
        console.error('Error searching movies:', error);
      }
    }

    // Display movies in grid
    function displayMovies(movies, containerId) {
      const container = document.getElementById(containerId);
      
      if (movies.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center">No movies found</p>';
        return;
      }

      container.innerHTML = movies.map(movie => `
        <div class="movie-card bg-gray-800 rounded-lg overflow-hidden cursor-pointer hover:scale-105 transition transform" onclick="showMovieDetails(${movie.id})">
          <img 
            src="${movie.poster_path ? IMG_BASE_URL + movie.poster_path : 'https://via.placeholder.com/500x750?text=No+Image'}" 
            alt="${movie.title}"
            class="w-full h-80 object-contain"
          />
          <div class="p-4">
            <h3 class="font-bold text-lg mb-2 line-clamp-2">${movie.title}</h3>
            <div class="flex justify-between items-center text-sm text-gray-400">
              <span>‚≠ê ${movie.vote_average.toFixed(1)}</span>
              <span>${movie.release_date ? movie.release_date.split('-')[0] : 'N/A'}</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Show movie details with reviews
    async function showMovieDetails(movieId) {
      try {
        const response = await fetch(`${BASE_URL}/movie/${movieId}?api_key=${API_KEY}`);
        const movie = await response.json();
        
        // Get reviews for this movie from local storage
        const movieReviews = reviews.filter(r => r.movieId === movieId);
        const avgRating = movieReviews.length > 0 
          ? (movieReviews.reduce((sum, r) => sum + r.rating, 0) / movieReviews.length).toFixed(1)
          : 'No ratings yet';

        document.getElementById('modal-content').innerHTML = `
          <div class="relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-white bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-75 z-10">
              ‚úï
            </button>
            <div class="relative h-96 bg-gradient-to-t from-gray-900 to-transparent">
              <img 
                src="${movie.backdrop_path ? `https://image.tmdb.org/t/p/original${movie.backdrop_path}` : 'https://via.placeholder.com/1280x720?text=No+Image'}" 
                alt="${movie.title}"
                class="w-full h-full object-contain opacity-50"
              />
              <div class="absolute bottom-0 left-0 right-0 p-8">
                <h2 class="text-4xl font-bold mb-2">${movie.title}</h2>
                <div class="flex gap-4 text-sm text-gray-300">
                  <span>‚≠ê ${movie.vote_average.toFixed(1)}/10</span>
                  <span>üìÖ ${movie.release_date || 'N/A'}</span>
                  <span>‚è±Ô∏è ${movie.runtime ? movie.runtime + ' min' : 'N/A'}</span>
                </div>
              </div>
            </div>
            
            <div class="p-8">
              <h3 class="text-xl font-bold mb-4">Overview</h3>
              <p class="text-gray-300 mb-6">${movie.overview || 'No overview available.'}</p>
              
              <div class="flex flex-wrap gap-2 mb-8">
                ${movie.genres ? movie.genres.map(g => `<span class="px-3 py-1 bg-red-500 bg-opacity-20 text-red-400 rounded-full text-sm">${g.name}</span>`).join('') : ''}
              </div>

              <!-- Add Review Form -->
              <div class="bg-gray-800 rounded-lg p-6 mb-8">
                <h3 class="text-xl font-bold mb-4">Write a Review</h3>
                <form onsubmit="submitReview(event, ${movieId}, '${movie.title.replace(/'/g, "\\'")}', '${movie.poster_path || ''}')">
                  <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Your Rating</label>
                    <div class="flex gap-1" id="star-rating">
                      ${[1,2,3,4,5].map(i => `<span class="star text-3xl text-gray-600" onclick="setRating(${i})">‚òÖ</span>`).join('')}
                    </div>
                    <input type="hidden" id="rating-value" required />
                  </div>
                  <div class="mb-4">
                    <label class="block text-sm font-medium mb-2">Your Review</label>
                    <textarea 
                      id="review-text" 
                      rows="4" 
                      class="w-full px-4 py-2 bg-gray-900 border border-gray-700 rounded focus:outline-none focus:ring-2 focus:ring-red-500"
                      placeholder="Share your thoughts about this movie..."
                      required
                    ></textarea>
                  </div>
                  <button type="submit" class="w-full bg-red-500 hover:bg-red-600 px-6 py-3 rounded-lg font-medium transition">
                    Submit Review
                  </button>
                </form>
              </div>

              <!-- Display Reviews -->
              <div>
                <h3 class="text-xl font-bold mb-4">User Reviews (${movieReviews.length}) - Avg Rating: ${avgRating}</h3>
                <div class="space-y-4">
                  ${movieReviews.length > 0 ? movieReviews.map(review => `
                    <div class="bg-gray-800 rounded-lg p-4">
                      <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center gap-2">
                          <span class="text-yellow-400">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5-review.rating)}</span>
                          <span class="text-sm text-gray-400">${new Date(review.timestamp).toLocaleDateString()}</span>
                        </div>
                        <button onclick="deleteReview('${review.id}')" class="text-red-400 hover:text-red-300 text-sm">Delete</button>
                      </div>
                      <p class="text-gray-300">${review.text}</p>
                    </div>
                  `).join('') : '<p class="text-gray-400">No reviews yet. Be the first to review!</p>'}
                </div>
              </div>
            </div>
          </div>
        `;
        
        document.getElementById('movie-modal').classList.remove('hidden');
      } catch (error) {
        console.error('Error fetching movie details:', error);
      }
    }

    // Close modal
    function closeModal(event) {
      if (!event || event.target.id === 'movie-modal') {
        document.getElementById('movie-modal').classList.add('hidden');
      }
    }

    // Star rating system
    let selectedRating = 0;
    function setRating(rating) {
      selectedRating = rating;
      document.getElementById('rating-value').value = rating;
      document.querySelectorAll('.star').forEach((star, index) => {
        if (index < rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });
    }

    // Submit review
    function submitReview(event, movieId, movieTitle, posterPath) {
      event.preventDefault();
      
      const rating = parseInt(document.getElementById('rating-value').value);
      const text = document.getElementById('review-text').value;
      
      const review = {
        id: Date.now().toString(),
        movieId: movieId,
        movieTitle: movieTitle,
        posterPath: posterPath,
        rating: rating,
        text: text,
        timestamp: new Date().toISOString()
      };
      
      reviews.unshift(review);
      localStorage.setItem('movieReviews', JSON.stringify(reviews));
      
      // Refresh the movie details to show new review
      showMovieDetails(movieId);
      
      alert('Review submitted successfully!');
    }

    // Delete review
    function deleteReview(reviewId) {
      if (confirm('Are you sure you want to delete this review?')) {
        reviews = reviews.filter(r => r.id !== reviewId);
        localStorage.setItem('movieReviews', JSON.stringify(reviews));
        
        // Find current movie ID and refresh
        const modalContent = document.getElementById('modal-content').innerHTML;
        const currentMovieId = reviews.length > 0 ? reviews[0].movieId : null;
        
        // Refresh current view
        if (document.getElementById('movie-modal').classList.contains('hidden')) {
          displayMyReviews();
        } else {
          // Extract movie ID from modal and refresh
          location.reload(); // Simple solution to refresh modal
        }
      }
    }

    // Display user's reviews
    function displayMyReviews() {
      const container = document.getElementById('reviews-list');
      
      if (reviews.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center">You haven\'t written any reviews yet. Browse movies and share your thoughts!</p>';
        return;
      }

      container.innerHTML = reviews.map(review => `
        <div class="bg-gray-800 rounded-lg p-6 flex gap-4">
          <img 
            src="${review.posterPath ? IMG_BASE_URL + review.posterPath : 'https://via.placeholder.com/100x150?text=No+Image'}" 
            alt="${review.movieTitle}"
            class="w-24 h-36 object-contain rounded cursor-pointer"
            onclick="showMovieDetails(${review.movieId})"
          />
          <div class="flex-1">
            <div class="flex justify-between items-start mb-2">
              <h3 class="text-xl font-bold cursor-pointer hover:text-red-400" onclick="showMovieDetails(${review.movieId})">${review.movieTitle}</h3>
              <button onclick="deleteReview('${review.id}')" class="text-red-400 hover:text-red-300 text-sm">Delete</button>
            </div>
            <div class="flex items-center gap-2 mb-3">
              <span class="text-yellow-400">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5-review.rating)}</span>
              <span class="text-sm text-gray-400">${new Date(review.timestamp).toLocaleDateString()}</span>
            </div>
            <p class="text-gray-300">${review.text}</p>
          </div>
        </div>
      `).join('');
    }

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      fetchTrendingMovies();
    });
  </script>
</body>
</html>

